<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="./hahastyles.css"/>
  <script type="text/javascript" src="./dropioApiClient.js"></script>
  <script type="text/javascript" src="./haha.js"></script>
  <script>
    var aname = getParam("name").replace("+"," ");
    var rname = nameFromAssetName(aname);
  </script>
</head>
<body>
  <div class="header">
    <span class="h1">H</span><span class="a1">a</span><span class="h2">h</span><span class="a2">a</span>, You're in a Photo!
  </div>
  
  <div id="subtitle" class="subtitle"></div>
   
  <div id="results" class="results">
    <table class="photo" align="center" cellspacing="10px"><tbody id="container"></tbody></table>
  </div>
  
  <br /><br />
  
  <div id="comments" class="center comments" style="display:none">
    <div class="subtitle" id="comment_subtitle">Comments on this Photo</div>
  </div>
  <div class="center comments" id="comment_on">
    <div class="subtitle">Comment on this Photo</div>
      <textarea rows="5" cols="70" id="comment_body"></textarea><br /><br />
      <input type="submit" value="Comment on this Photo!" onclick="submitComment()" />
  </div>
  
  <div class="upload_now">
    <a id="upload_now" href="#" class="upload_now"></a>
  </div>
  
  <br /><br /><br />
  
  
  <div class="footer">
    <a href="./index.html" class="footer">Home</a> |
    <a href="./about.html" class="footer">About</a> |
    <a href="./upload.html" class="footer">Upload an Embarrassing Photo of Someone</a> |
    <a href="./see_all.html?page=1" class="footer">See All Embarrassing Photos</a>
  </div>
  
  <script>
   api.getAsset({drop_name:HAHA_DATABASE_NAMES,asset_name:aname},lookup_done);
   
   function lookup_done(response,success) {
    if( success ) {
       rname = nameFromAssetName(response.contents);
       document.getElementById("subtitle").innerHTML = rname;
       document.getElementById("upload_now").innerHTML = "Upload another embarrassing photo of " + rname + " now";
       document.getElementById("upload_now").href = "./upload.html?name=" + rname;
       api.getAsset({drop_name:PHOTO_BUCKET,asset_name:aname},showPic);
    }
    else
       alert("Oops. Something went wrong: " + response.message);
   }
       
   function showPic(response,success) {
    if(success) {
      createPhoto(response,true);
      api.getCommentList({drop_name:PHOTO_BUCKET,asset_name:aname},showComments);
    }
    else {
      document.getElementById("results").innerHTML = "Sorry, there is no photo here."
      document.getElementById("comment_on").style.display = "none"
    }
   }

   function showComments(response,success) {
    if( success ) {
      for( i = 0; i < response.length; i++ ) {
        createComment(response[i]);
      }
      if( response.length != 0 )
        document.getElementById("comments").style.display = ""
    }
   }
   
   function submitComment() {
    comment = document.getElementById("comment_body").value;
    if( comment == "" ) {
      alert("You must type something first!");
      return;
    }
    api.createComment({drop_name:PHOTO_BUCKET,asset_name:aname,contents:comment},commentAdded);
   }
   
   function commentAdded(response,success) {
    if( success ) { 
      createComment(response);
      document.getElementById("comments").style.display = ""
      location.hash = "comment_" + response.id
      document.getElementById("comment_body").innerHTML = ""
    } else
      alert("Oops. Something went wrong: " + response.message);
   }
  </script>
</body>
</html>
    
